#!/usr/bin/env php
<?php declare(strict_types=1);

use PatrickMaynard\AuditClassGenerator\Applier;

include $_composer_autoload_path ?? __DIR__ . '/../vendor/autoload.php';

$options = getopt('d:e:vh', ['directory:', 'extension:', 'verbose', 'help']);

$helpText = <<<TEXT
Usage: vendor/bin/audit-class-generator [options]

Options:
  -d, --directory  Verzeichnis zum Scannen (default: templates)
  -e, --extension  Dateiendung filtern (default: .html.twig)
  -v, --verbose    AusfÃ¼hrliche Ausgabe aktivieren
  -h, --help       Diese Hilfe anzeigen
TEXT;

if (isset($options['h']) || isset($options['help'])) {
    fwrite(STDOUT, $helpText . PHP_EOL . PHP_EOL . PHP_EOL);
    exit(0);
}

//First, we need to be on a safe git branch, since this set of changes will mess with lots of files
exec('git checkout -b temporary-template-audit-branch-remove-me-soon');

echo PHP_EOL;
echo "Temporary git branch created. Iterating through templates ... ";
echo PHP_EOL;

$config = Config::create($options);
$applier = new Applier($config);

$applier->applyAllAuditTags();
